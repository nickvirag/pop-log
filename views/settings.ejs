<% layout('layout') %>
<script>
  $(document).ready(function() {
    $('#organizationSubmit').click(function() {
      $.ajax({
        url: '/api/updateSettings',
        method: 'PUT',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify({
          user: '<%= user._id %>',
          emailUsername: $('#emailUsername').val(),
          emailPassword: $('#emailPassword').val()
        }),
        success: function(data) {
          alert('Organization updated!');
        }
      });
    });

    $('#sendTestMail').click(function() {
      $.ajax({
        url: '/api/sendTestMail',
        method: 'POST',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify({
          user: '<%= user._id %>',
          organization: '<%= user.organization %>'
        }),
        success: function(data) {
          alert('Test email sent!');
        }
      });
    });
  });
</script>
<div class="card">
  <div class="cardContents">
    <div class="cardTitle">SETTINGS</div>
    <% if (user.isAdmin) { %>
    ORGANIZATION EMAIL<br>
    <input id="emailUsername" type="text" value="<%= organization.emailUsername %>"><br>
    <br>
    <br>
    ORGANIZATION EMAIL PASSWORD<br>
    <input id="emailPassword" type="password" value="<%= organization.emailPassword %>"><br>
    <br>
    <br>
    <a href="https://www.google.com/settings/security/lesssecureapps" target="_blank">Enable emailing on gmail</a>
    <br>
    <br>
    <button id="organizationSubmit">Submit</button> <button id="sendTestMail">Send test email to <%= user.email %></button>
    <% } else { %>
    COMING SOON
    <% } %>
  </div>
</div>
